<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inruilwaarde Fietsen</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0078D7">
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- Styles -->
  <link rel="stylesheet" href="/styles.css?v=9.4">
</head>
<body>
  <header>
    <div class="hdr-left">
      <img src="/logofietsserviceidtransparant-ezgif.com-resize.png" alt="Fiets Service ID" />
      <h1>Inruilwaarde‑calculator</h1>
    </div>
    <div class="hdr-right">
      <div id="licenseBanner"></div>
      <button id="installBtn" hidden>Installeer app</button>
    </div>
  </header>

  <main>
    <!-- Invoerkaart -->
    <section class="card">
      <h2>Invoer</h2>
      <div class="grid">
        <label>Type fiets
          <select id="typeSelect"></select>
        </label>

        <label>Merk
          <select id="brandSelect"></select>
        </label>

        <label>Staat
          <select id="stateSelect"></select>
        </label>

        <label id="accuStateWrap">Accustaat
          <select id="accuStateSelect"></select>
        </label>

        <label>Heeft accu?
          <select id="hasAccuSelect">
            <option value="auto" selected>Automatisch (per type)</option>
            <option value="ja">Ja</option>
            <option value="nee">Nee</option>
          </select>
        </label>

        <label>Leeftijd (0–15 jaar)
          <input id="ageInput" type="number" min="0" max="15" value="5" />
        </label>

        <label>Nieuwprijs / Aanschafprijs (€)
          <input id="priceInput" type="number" min="0" step="1" placeholder="Laat leeg voor referentieprijs" />
        </label>

        <!-- ✅ Nieuw: Km-stand (alleen voor elektrische types) -->
        <label id="kmStandWrap">Km‑stand (alleen E‑bike/elektrische bakfiets)
          <input id="kmStandInput" type="number" min="0" max="30000" step="100" placeholder="bijv. 8000" />
        </label>

        <div class="hint" id="refPriceHint"></div>
      </div>

      <button id="calcBtn">Bereken inruilwaarde</button>
    </section>

    <!-- Resultaatkaart -->
    <section class="card" id="resultCard" hidden>
      <h2>Resultaat</h2>
      <div class="result-line">
        <span>Inruilwaarde</span>
        <strong><span id="resultValue">€ 0</span></strong>
      </div>

      <details>
        <summary>Toelichting en factoren</summary>
        <ul>
          <li>Leeftijdsfactor: <span id="factorAge"></span></li>
          <li>Conditiefactor: <span id="factorState"></span></li>
          <li>Accufactor: <span id="factorAccu"></span></li>
          <li>Merkfactor: <span id="factorBrand"></span></li>
          <!-- ✅ Toegevoegd: kilometerfactor -->
          <li>Kilometerfactor (km‑stand): <span id="factorKmStand"></span></li>
        </ul>
      </details>

      <div class="actions">
        <button id="printOfferBtn">Maak offerte (print/pdf)</button>
      </div>
    </section>

    <!-- Offertekaart -->
    <section class="card" id="offerCard">
      <h2>Offerte – Inruilvoorstel</h2>
      <div class="offer-grid">
        <label>Naam Klant: <input id="offerName" placeholder="Naam klant"></label>

        <div class="kv">
          <div>Type fiets:</div><div id="offerType"></div>
          <div>Merk:</div><div id="offerBrand"></div>
          <div>Staat:</div><div id="offerState"></div>
          <div>Leeftijd:</div><div id="offerAge"></div>
        </div>

        <div class="offer-total">Inruilprijs: <strong id="offerTotal">€ 0</strong></div>

        <p class="small">
          Deze inruilwaarde is tot stand gekomen op basis van type fiets, leeftijd, algemene staat en (indien van toepassing) km‑stand.
          Dit voorstel is indicatief en onder voorbehoud van fysieke inspectie.
        </p>

        <div class="kv">
          <div>Datum:</div><div id="offerDate"></div>
        </div>

        <div class="signatures">
          <div>Handtekening klant: _____________________________</div>
          <div>Handtekening dealer: _____________________________</div>
        </div>

        <div class="actions no-print"><button onclick="window.print()">Print / Exporteer PDF</button></div>
      </div>
    </section>
  </main>

  <footer>
    <small>© <span id="year"></span> Inruilwaarde Fietsen By FsiD BV</small><br>
    <div class="small muted" id="licenseFooter"></div>
  </footer>

  <!-- Licentie overlay -->
  <div id="licenseGate" class="license-overlay" hidden>
    <div class="license-card" role="dialog" aria-labelledby="licenseTitle" aria-modal="true">
      <header>
        <img src="/logofietsserviceidtransparant-ezgif.com-resize.png" alt="" />
        <div>
          <h2 id="licenseTitle" style="margin:0">Licentie vereist</h2>
          <div class="small" id="licenseSubtitle">
            Activeer met installatiecode of vraag een code aan (€ <span id="licensePriceHeader">99,00</span> p/j ex. btw).
          </div>
        </div>
      </header>

      <div class="license-body">
        <!-- Panel: ik heb een code -->
        <div class="license-panel">
          <h3>Ik heb een installatiecode</h3>
          <label>Installatiecode</label>
          <input id="licCodeInput" placeholder="bijv. FSID-ABCD-EFGH-JKLM" autocomplete="one-time-code">
          <div class="license-actions">
            <button class="btn" id="activateLicBtn" type="button">Activeer</button>
            <button class="btn secondary" id="pasteLicBtn" type="button">Plakken</button>
          </div>
          <p class="small muted">Na activatie is de licentie 12 maanden geldig op dit apparaat (PWA).</p>
          <div id="licMsg" class="small"></div>
        </div>

        <!-- Panel: geen code, aanvraag -->
        <div class="license-panel">
          <h3>Geen code? Vraag er één aan</h3>
          <!-- … (je formulier velden) … -->
          <div class="license-actions">
            <a class="btn" href="mailto:info@fietsserviceid.nl?subject=Aanvraag%20installatiecode%20%E2%80%94%20Fiets%20Service%20ID">Aanvraag e‑mail opstellen</a>
            <button class="btn secondary" id="saveDraftBtn" type="button">Gegevens onthouden</button>
          </div>
          <p class="small muted">We genereren een e‑mail met uw NAW‑gegevens en het verzoek om een 1‑jarige licentie (€ <span id="licensePriceBody">99,00</span> ex. btw).</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/app.js?v=9.4" defer></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js', { scope: '/' }).catch(console.error);
    }
    document.addEventListener('DOMContentLoaded', () => {
      const y = document.getElementById('year');
      if (y) y.textContent = new Date().getFullYear();
    });
    (function(){
      function setVh(){ document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`); }
      setVh(); window.addEventListener('resize', setVh);
    })();
  </script>
</body>
</html>
