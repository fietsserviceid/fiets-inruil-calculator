
<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inruilwaarde Fietsen</title>

  <link rel="stylesheet" href="./styles.css">
</head>
<body>

<!-- ===================================================
     INSTALLATIE-GATE
     =================================================== -->
<script>
(function () {
  const STORAGE_KEY = "fsid_install_activated";
  const META_KEY = "fsid_install_meta";

  const INSTALL_CODES = [
    "FSID-28UL-BRXL-Q8HL",
    "FSID-2DGK-9EYC-U95C",
    "FSID-2HNS-LQAE-UK2N"
    /* (volledige lijst staat al stabiel in je repo / Excel) */
  ];

  let meta = null;
  try {
    meta = JSON.parse(localStorage.getItem(META_KEY) || "null");
  } catch {}

  if (!meta || localStorage.getItem(STORAGE_KEY) !== "1") {
    document.body.innerHTML = `
      <main class="card" style="max-width:640px;margin:40px auto;">
        <h2>Installatie vereist</h2>
        <p>Deze applicatie vereist een jaarabonnement.</p>

        <label>Dealernaam
          <input id="dealer">
        </label>

        <label>Installatiecode
          <input id="code">
        </label>

        <label>
          <input type="checkbox" id="agree">
          Ik ga akkoord met het jaarabonnement
        </label>

        <button id="activateBtn">Activeer</button>

        <hr style="margin:20px 0;">
        <p style="font-size:14px;color:#555;">
          Nog geen installatiecode?
        </p>
        <a
          id="requestLink"
          style="display:inline-block;padding:10px 16px;background:#eee;border-radius:6px;text-decoration:none;"
        >
          Installatiecode aanvragen
        </a>
      </main>
    `;

    const dealerInput = document.getElementById("dealer");
    const requestLink = document.getElementById("requestLink");

    function updateMail() {
      const dealer = encodeURIComponent(dealerInput.value || "");
      requestLink.href =
        "mailto:info@fietsserviceid.nl" +
        "?subject=Aanvraag installatiecode Fiets Inruil Calculator" +
        "&body=" +
        encodeURIComponent(
          "Bedrijfsnaam: " + dealer + "\n" +
          "Contactpersoon:\n" +
          "Adres:\n" +
          "Postcode / Plaats:\n" +
          "E-mail:\n" +
          "Telefoon:\n" +
          "KvK-nummer:\n\n" +
          "Graag ontvangen wij een installatiecode."
        );
    }
    dealerInput.addEventListener("input", updateMail);
    updateMail();

    document.getElementById("activateBtn").onclick = function () {
      const dealer = dealerInput.value.trim();
      const code = document.getElementById("code").value.trim().toUpperCase();
      const agree = document.getElementById("agree").checked;

      if (!dealer || !agree || !INSTALL_CODES.includes(code)) {
        alert("Vul alles correct in");
        return;
      }

      localStorage.setItem(META_KEY, JSON.stringify({ dealer, code }));
      localStorage.setItem(STORAGE_KEY, "1");
      location.reload();
    };

    return;
  }
})();
</script>

<!-- ===================================================
     OUDE CALCULATOR (ONGEWIJZIGD)
     =================================================== -->

<header>
  <h1>Inruilwaarde-calculator</h1>
</header>


<main>
  <section class="card">
    <h2>Invoer</h2>
    <div class="grid">
      <label>Type fiets
        <select id="typeSelect"></select>
      </label>
      <label>Merk
        <select id="brandSelect"></select>
      </label>
      <label>Staat
        <select id="stateSelect"></select>
      </label>
      <label id="accuStateWrap">Accustaat
        <select id="accuStateSelect"></select>
      </label>
      <label>Heeft accu?
        <select id="hasAccuSelect">
          <option value="auto" selected>Automatisch (per type)</option>
          <option value="ja">Ja</option>
          <option value="nee">Nee</option>
        </select>
      </label>
      <label>Leeftijd (0–15 jaar)
        <input id="ageInput" type="number" min="0" max="15" value="5">
      </label>
      <label>Nieuwprijs / Aanschafprijs (€)
        <input id="priceInput" type="number" min="0" step="1" placeholder="Laat leeg voor referentieprijs">
      </label>
      <div class="hint" id="refPriceHint"></div>
    </div>
<button id="calcBtn" onclick="calculate()">Bereken inruilwaarde</button>

  </section>

  <section class="card" id="resultCard" hidden>
    <h2>Resultaat</h2>
    <div class="result-line">
      <span>Inruilwaarde</span>
      <strong><span id="resultValue">€ 0</span></strong>
    </div>
    <details>
      <summary>Toelichting en factoren</summary>
      <ul>
        <li>Leeftijdsfactor: <span id="factorAge"></span></li>
        <li>Conditiefactor: <span id="factorState"></span></li>
        <li>Accufactor: <span id="factorAccu"></span></li>
        <li>Merkfactor: <span id="factorBrand"></span></li>
      </ul>
    </details>
    <div class="actions">
      <button id="printOfferBtn">Maak offerte (print/pdf)</button>
    </div>
  </section>

  <section class="card" id="offerCard">
    <h2>Offerte – Inruilvoorstel</h2>
    <div class="offer-grid">
      <label>Naam Klant:
        <input id="offerName" placeholder="Naam klant">
      </label>
      <div class="kv">
        <div>Type fiets:</div><div id="offerType"></div>
        <div>Merk:</div><div id="offerBrand"></div>
        <div>Staat:</div><div id="offerState"></div>
        <div>Leeftijd:</div><div id="offerAge"></div>
      </div>
      <div class="offer-total">
        Inruilprijs: <strong id="offerTotal">€ 0</strong>
      </div>
      <p class="small">
        Deze inruilwaarde is indicatief en onder voorbehoud van fysieke inspectie.
      </p>
      <div class="kv">
        <div>Dealer:</div><div id="offerDealer"></div>
      </div>
      <div class="kv">
        <div>Datum:</div><div id="offerDate"></div>
      </div>
      <div class="signatures">
        <div>Handtekening klant: __________________________</div>
        <div>Handtekening dealer: __________________________</div>
      </div>
      <div class="actions no-print">
        <button onclick="window.print()">Print / Exporteer PDF</button>
      </div>
    </div>
  </section>
</main>

<footer>
  <small>
    © <span id="year"></span> Inruilwaarde Fietsen –
    <strong id="dealerFooter"></strong>
  </small>
</footer>

<script src="./app.js"></script>

<script>
  // Jaar + dealer in footer en offerte
  document.getElementById("year").innerText = new Date().getFullYear();

  try {
    const meta = JSON.parse(localStorage.getItem("fsid_install_meta") || "null");
    if (meta && meta.dealer) {
      document.getElementById("dealerFooter").innerText =
        "Dealer: " + meta.dealer;

      const offerDealer = document.getElementById("offerDealer");
      if (offerDealer) {
        offerDealer.innerText = "Dealer: " + meta.dealer;
      }
    }
  } catch {}
</script>

</body>
</html>
